# MCD-TSF: Multi-modal Conditional Diffusion for Time Series Forecasting

åŸºäºæ‰©æ•£æ¨¡å‹çš„å¤šæ¨¡æ€æ—¶é—´åºåˆ—é¢„æµ‹æ¡†æ¶ï¼Œä¸“é—¨ç”¨äºé“œä»·é¢„æµ‹ï¼Œç»“åˆæ•°å€¼æ•°æ®å’Œæ–‡æœ¬ç ”æŠ¥ä¿¡æ¯ã€‚

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†MCD-TSFï¼ˆMulti-modal Conditional Diffusion for Time Series Forecastingï¼‰æ¨¡å‹ï¼Œç”¨äºé¢„æµ‹é“œä»·èµ°åŠ¿ã€‚æ¨¡å‹ç»“åˆäº†ï¼š
- **æ•°å€¼æ•°æ®**ï¼šæ—¥é¢‘çš„é“œä»·ã€æˆäº¤é‡ã€æŒä»“ç­‰é‡‘èæŒ‡æ ‡
- **æ–‡æœ¬æ•°æ®**ï¼šæœˆé¢‘çš„é“œå¸‚åœºç ”æŠ¥å’Œåˆ†æå¸ˆè§‚ç‚¹
- **æ‰©æ•£æ¨¡å‹**ï¼šç”Ÿæˆå¤šä¸ªé¢„æµ‹æ ·æœ¬ï¼Œæä¾›ä¸ç¡®å®šæ€§é‡åŒ–

## ä¸»è¦ç‰¹æ€§

### ğŸ¯ å¤šæ¨¡æ€èåˆ
- æ•°å€¼æ—¶é—´åºåˆ—æ•°æ®ï¼ˆæ—¥é¢‘ï¼‰
- æ–‡æœ¬ç ”æŠ¥æ•°æ®ï¼ˆæœˆé¢‘ï¼‰
- è‡ªåŠ¨æ—¶é—´å¯¹é½æœºåˆ¶

### ğŸ“Š ä¸ç¡®å®šæ€§é‡åŒ–
- ç”Ÿæˆå¤šä¸ªé¢„æµ‹æ ·æœ¬ï¼ˆé»˜è®¤15ä¸ªï¼‰
- æä¾›50%å’Œ90%ç½®ä¿¡åŒºé—´
- æ¦‚ç‡åˆ†å¸ƒåˆ†æ

### ğŸ”„ é‡å é¢„æµ‹å¤„ç†
- è‡ªåŠ¨å¤„ç†æ»‘åŠ¨çª—å£é¢„æµ‹ä¸­çš„é‡å é—®é¢˜
- å¤šç§æœ€ç»ˆé¢„æµ‹é€‰æ‹©ç­–ç•¥ï¼š
  - æœ€æ–°é¢„æµ‹ï¼ˆLatestï¼‰
  - å¹³å‡å€¼ï¼ˆAverageï¼‰
  - åŠ æƒå¹³å‡ï¼ˆWeightedï¼‰
  - ä¸­ä½æ•°ï¼ˆMedianï¼‰
  - é›†æˆæ–¹æ³•ï¼ˆEnsembleï¼‰

### ğŸ“ˆ çµæ´»çš„ç›®æ ‡å˜é‡
- æ”¯æŒäºŒåˆ†ç±»é¢„æµ‹ï¼ˆæ¶¨è·Œï¼‰
- æ”¯æŒè¿ç»­å€¼é¢„æµ‹ï¼ˆæ”¶ç›Šç‡ï¼‰
- è‡ªåŠ¨æ£€æµ‹ç›®æ ‡ç±»å‹å¹¶åº”ç”¨ç›¸åº”æŒ‡æ ‡

## é¡¹ç›®ç»“æ„

```
MCD-TSF-copper/
â”œâ”€â”€ config/                    # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ economy_36_6.yaml     # æ¨¡å‹é…ç½®
â”œâ”€â”€ data_provider/            # æ•°æ®åŠ è½½å™¨
â”‚   â”œâ”€â”€ data_factory.py       # æ•°æ®å·¥å‚
â”‚   â””â”€â”€ data_loader.py        # æ•°æ®åŠ è½½é€»è¾‘
â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ prepare4llm.py        # LLMå‡†å¤‡å‡½æ•°
â”‚   â”œâ”€â”€ utils.py              # è®­ç»ƒå’Œè¯„ä¼°å·¥å…·
â”‚   â””â”€â”€ timefeatures.py       # æ—¶é—´ç‰¹å¾
â”œâ”€â”€ main_model.py             # ä¸»æ¨¡å‹å®šä¹‰
â”œâ”€â”€ diff_models.py            # æ‰©æ•£æ¨¡å‹
â”œâ”€â”€ exe_forecasting.py        # æ‰§è¡Œè„šæœ¬
â”œâ”€â”€ dataset_forecasting.py    # æ•°æ®é›†å®šä¹‰
â”œâ”€â”€ view_predictions.py       # åŸºç¡€é¢„æµ‹æŸ¥çœ‹å™¨
â”œâ”€â”€ advanced_prediction_viewer.py  # é«˜çº§é¢„æµ‹åˆ†æå™¨
â”œâ”€â”€ overlapping_prediction_handler.py  # é‡å é¢„æµ‹å¤„ç†å™¨
â””â”€â”€ select_final_predictions.py       # æœ€ç»ˆé¢„æµ‹é€‰æ‹©å™¨
```

## å®‰è£…è¦æ±‚

```bash
# åŸºç¡€ä¾èµ–
torch>=2.4.0
torchvision
torchaudio
transformers>=4.20.0
pandas>=1.3.0
numpy>=1.21.0
scikit-learn>=1.0.0
matplotlib>=3.5.0
seaborn>=0.11.0
tqdm

# CUDAæ”¯æŒï¼ˆå¯é€‰ï¼‰
# ç¡®ä¿å®‰è£…æ”¯æŒCUDAçš„PyTorchç‰ˆæœ¬
```

## æ•°æ®æ ¼å¼è¦æ±‚

### æ•°å€¼æ•°æ® (copper/numerical/copper/copper.csv)
```csv
date,start_date,end_date,OT,feature1,feature2,...
2010/6/22,2010/6/22,2010/6/22,1,value1,value2,...
```

### æ–‡æœ¬æ•°æ® (copper/textual/copper/)
- `copper_report.csv`: ç ”æŠ¥æ•°æ®
- `copper_search.csv`: æœç´¢æ•°æ®

```csv
start_date,end_date,fact,pred
2010-05-23,2010-06-22,"ç ”æŠ¥å†…å®¹...","é¢„æµ‹å†…å®¹..."
```

## ä½¿ç”¨æ–¹æ³•

### 1. åŸºç¡€è®­ç»ƒå’Œé¢„æµ‹

```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate dva38

# è¿è¡Œè®­ç»ƒå’Œé¢„æµ‹
python -u exe_forecasting.py \
  --root_path ../copper \
  --data_path copper/copper.csv \
  --config economy_36_6.yaml \
  --seq_len 36 \
  --pred_len 6 \
  --text_len 36 \
  --freq m \
  --device cuda:0 \
  --num_workers 0
```

### 2. æŸ¥çœ‹é¢„æµ‹ç»“æœ

```bash
# åŸºç¡€é¢„æµ‹åˆ†æ
python view_predictions.py

# é«˜çº§é¢„æµ‹åˆ†æï¼ˆåŒ…å«æ¦‚ç‡åˆ†å¸ƒå’Œç½®ä¿¡åŒºé—´ï¼‰
python advanced_prediction_viewer.py
```

### 3. å¤„ç†é‡å é¢„æµ‹

```bash
# æ¼”ç¤ºé‡å é¢„æµ‹é—®é¢˜
python select_final_predictions.py

# å¤„ç†å®é™…é¢„æµ‹ç»“æœ
python overlapping_prediction_handler.py
```

## é…ç½®è¯´æ˜

### æ¨¡å‹å‚æ•°
- `seq_len`: è¾“å…¥åºåˆ—é•¿åº¦ï¼ˆé»˜è®¤36å¤©ï¼‰
- `pred_len`: é¢„æµ‹é•¿åº¦ï¼ˆé»˜è®¤6å¤©ï¼‰
- `text_len`: æ–‡æœ¬åºåˆ—é•¿åº¦ï¼ˆé»˜è®¤36å¤©ï¼‰
- `nsample`: ç”Ÿæˆæ ·æœ¬æ•°é‡ï¼ˆé»˜è®¤15ä¸ªï¼‰

### æ‰©æ•£æ¨¡å‹å‚æ•°
- `num_steps`: æ‰©æ•£æ­¥æ•°ï¼ˆé»˜è®¤500ï¼‰
- `sample_steps`: é‡‡æ ·æ­¥æ•°ï¼ˆé»˜è®¤100ï¼‰
- `beta_start/beta_end`: å™ªå£°è°ƒåº¦å‚æ•°

## è¾“å‡ºç»“æœ

### é¢„æµ‹æ–‡ä»¶
- `generated_*.npy`: åŸå§‹é¢„æµ‹æ ·æœ¬
- `prediction_median_*.npy`: ä¸­ä½æ•°é¢„æµ‹
- `prediction_mean_*.npy`: å‡å€¼é¢„æµ‹
- `confidence_50_*.npy`: 50%ç½®ä¿¡åŒºé—´
- `confidence_90_*.npy`: 90%ç½®ä¿¡åŒºé—´

### åˆ†ææŠ¥å‘Š
- `config_results.json`: è¯„ä¼°æŒ‡æ ‡
- `detailed_predictions.csv`: è¯¦ç»†é¢„æµ‹ç»“æœ
- `prediction_distribution.png`: é¢„æµ‹åˆ†å¸ƒå›¾
- `final_predictions_analysis.json`: é‡å é¢„æµ‹åˆ†æ

## è¯„ä¼°æŒ‡æ ‡

### äºŒåˆ†ç±»ä»»åŠ¡ï¼ˆæ¶¨è·Œé¢„æµ‹ï¼‰
- å‡†ç¡®ç‡ï¼ˆAccuracyï¼‰
- ç²¾ç¡®ç‡ï¼ˆPrecisionï¼‰
- å¬å›ç‡ï¼ˆRecallï¼‰
- F1åˆ†æ•°
- ä¸Šæ¶¨æ¦‚ç‡

### è¿ç»­å€¼ä»»åŠ¡ï¼ˆæ”¶ç›Šç‡é¢„æµ‹ï¼‰
- å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰
- å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMAEï¼‰
- æ­£æ”¶ç›Šç‡æ¦‚ç‡
- ç½®ä¿¡åŒºé—´è¦†ç›–ç‡

## é«˜çº§åŠŸèƒ½

### 1. æ¦‚ç‡åˆ†å¸ƒåˆ†æ
- é¢„æµ‹å€¼åˆ†å¸ƒç»Ÿè®¡
- ä¸ç¡®å®šæ€§é‡åŒ–
- ç½®ä¿¡åŒºé—´åˆ†æ

### 2. é‡å é¢„æµ‹å¤„ç†
- è‡ªåŠ¨è¯†åˆ«é‡å é¢„æµ‹
- å¤šç§é€‰æ‹©ç­–ç•¥
- ä¸€è‡´æ€§åˆ†æ

### 3. å¯è§†åŒ–åˆ†æ
- é¢„æµ‹åˆ†å¸ƒå›¾
- ç½®ä¿¡åŒºé—´å¯è§†åŒ–
- æ—¶é—´åºåˆ—é¢„æµ‹å›¾

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®è·¯å¾„**ï¼šç¡®ä¿æ•°æ®æ–‡ä»¶è·¯å¾„æ­£ç¡®
2. **GPUå†…å­˜**ï¼šå¤§æ¨¡å‹å¯èƒ½éœ€è¦è¾ƒå¤šGPUå†…å­˜
3. **è®­ç»ƒæ—¶é—´**ï¼šå®Œæ•´è®­ç»ƒå¯èƒ½éœ€è¦æ•°å°æ—¶
4. **æ•°æ®è´¨é‡**ï¼šç¡®ä¿æ•°å€¼å’Œæ–‡æœ¬æ•°æ®çš„æ—¶é—´å¯¹é½

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚

## å¼•ç”¨

å¦‚æœæ‚¨ä½¿ç”¨äº†æœ¬é¡¹ç›®ï¼Œè¯·å¼•ç”¨ç›¸å…³è®ºæ–‡ï¼š

```bibtex
@article{mcd_tsf_2024,
  title={Multi-modal Conditional Diffusion for Time Series Forecasting},
  author={Your Name},
  journal={Your Journal},
  year={2024}
}
```

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·é€šè¿‡GitHub Issuesè”ç³»ã€‚
